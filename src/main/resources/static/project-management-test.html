<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .delete-btn {
            background-color: #dc3545;
        }
        .delete-btn:hover {
            background-color: #c82333;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .project-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .project-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }
        .project-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .image-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .image-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background-color: #f9f9f9;
            cursor: pointer;
        }
        .image-item.selected {
            background-color: #007bff;
            color: white;
        }
        .image-thumbnail {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Project Management Test</h1>

    <!-- 프로젝트 생성 -->
    <div class="section">
        <h2>프로젝트 생성</h2>
        <form id="createProjectForm">
            <div class="form-group">
                <label for="projectName">프로젝트명:</label>
                <input type="text" id="projectName" name="projectName" required>
            </div>
            <div class="form-group">
                <label for="description">설명:</label>
                <textarea id="description" name="description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="duration">기간:</label>
                <input type="text" id="duration" name="duration">
            </div>
            <div class="form-group">
                <label for="grossFloorArea">연면적:</label>
                <input type="text" id="grossFloorArea" name="grossFloorArea">
            </div>
            <div class="form-group">
                <label for="client">클라이언트:</label>
                <input type="text" id="client" name="client">
            </div>
            <div class="form-group">
                <label for="architect">건축가:</label>
                <input type="text" id="architect" name="architect">
            </div>
            <div class="form-group">
                <label for="index">인덱스:</label>
                <input type="number" id="index" name="index" value="0">
            </div>
            <div class="form-group">
                <label for="isAvailable">사용 가능:</label>
                <select id="isAvailable" name="isAvailable">
                    <option value="true">예</option>
                    <option value="false">아니오</option>
                </select>
            </div>
            <button type="submit">프로젝트 생성</button>
        </form>
    </div>

    <!-- 프로젝트 업데이트 -->
    <div class="section">
        <h2>프로젝트 업데이트</h2>
        <div class="form-group">
            <label for="updateProjectId">업데이트할 프로젝트 ID:</label>
            <input type="number" id="updateProjectId" name="updateProjectId" required>
            <button onclick="loadProjectForUpdate()">프로젝트 로드</button>
        </div>
        <form id="updateProjectForm" style="display: none;">
            <div class="form-group">
                <label for="updateProjectName">프로젝트명:</label>
                <input type="text" id="updateProjectName" name="projectName">
            </div>
            <div class="form-group">
                <label for="updateDescription">설명:</label>
                <textarea id="updateDescription" name="description" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="updateDuration">기간:</label>
                <input type="text" id="updateDuration" name="duration">
            </div>
            <div class="form-group">
                <label for="updateGrossFloorArea">연면적:</label>
                <input type="text" id="updateGrossFloorArea" name="grossFloorArea">
            </div>
            <div class="form-group">
                <label for="updateClient">클라이언트:</label>
                <input type="text" id="updateClient" name="client">
            </div>
            <div class="form-group">
                <label for="updateArchitect">건축가:</label>
                <input type="text" id="updateArchitect" name="architect">
            </div>
            <div class="form-group">
                <label for="updateIndex">인덱스:</label>
                <input type="number" id="updateIndex" name="index">
            </div>
            <div class="form-group">
                <label for="updateIsAvailable">사용 가능:</label>
                <select id="updateIsAvailable" name="isAvailable">
                    <option value="">변경 안함</option>
                    <option value="true">예</option>
                    <option value="false">아니오</option>
                </select>
            </div>
            <button type="submit">프로젝트 업데이트</button>
        </form>
    </div>

    <!-- 이미지 관리 -->
    <div class="section">
        <h2>프로젝트 이미지 관리</h2>
        <div class="form-group">
            <label for="manageProjectId">관리할 프로젝트 ID:</label>
            <input type="number" id="manageProjectId" name="manageProjectId" required>
            <button onclick="loadImagesForManagement()">이미지 로드</button>
        </div>
        
        <div id="imageManagement" style="display: none;">
            <h3>사용 가능한 이미지들</h3>
            <div id="availableImages" class="image-list"></div>
            
            <div style="margin-top: 20px;">
                <button onclick="updateProjectImages()">선택된 이미지로 업데이트</button>
                <button onclick="addImagesToProject()">선택된 이미지 추가</button>
                <button onclick="removeImagesFromProject()" class="delete-btn">선택된 이미지 제거</button>
            </div>
        </div>
    </div>

    <!-- 결과 표시 -->
    <div id="result"></div>

    <!-- 프로젝트 목록 -->
    <div class="section">
        <h2>프로젝트 목록</h2>
        <button onclick="loadProjects()">프로젝트 목록 새로고침</button>
        <div id="projectList" class="project-list"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080';
        let selectedImages = [];

        // 페이지 로드 시 프로젝트 목록 로드
        window.onload = function() {
            loadProjects();
        };

        // 프로젝트 생성
        document.getElementById('createProjectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const projectData = {
                projectName: formData.get('projectName'),
                description: formData.get('description'),
                duration: formData.get('duration'),
                grossFloorArea: formData.get('grossFloorArea'),
                client: formData.get('client'),
                architect: formData.get('architect'),
                index: parseInt(formData.get('index')),
                isAvailable: formData.get('isAvailable') === 'true'
            };

            try {
                const response = await fetch(`${API_BASE_URL}/projects`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(projectData)
                });

                const result = await response.json();

                if (response.ok) {
                    showResult(`프로젝트 생성 성공! ID: ${result.id}`, 'success');
                    e.target.reset();
                    loadProjects();
                } else {
                    showResult(`프로젝트 생성 실패: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        });

        // 프로젝트 업데이트를 위한 로드
        async function loadProjectForUpdate() {
            const projectId = document.getElementById('updateProjectId').value;
            if (!projectId) {
                showResult('프로젝트 ID를 입력해주세요.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${projectId}`);
                const project = await response.json();

                if (response.ok) {
                    document.getElementById('updateProjectName').value = project.projectName || '';
                    document.getElementById('updateDescription').value = project.description || '';
                    document.getElementById('updateDuration').value = project.duration || '';
                    document.getElementById('updateGrossFloorArea').value = project.grossFloorArea || '';
                    document.getElementById('updateClient').value = project.client || '';
                    document.getElementById('updateArchitect').value = project.architect || '';
                    document.getElementById('updateIndex').value = project.index || '';
                    document.getElementById('updateIsAvailable').value = project.isAvailable ? 'true' : 'false';
                    
                    document.getElementById('updateProjectForm').style.display = 'block';
                    showResult('프로젝트 정보를 로드했습니다.', 'success');
                } else {
                    showResult(`프로젝트 로드 실패: ${project.message}`, 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        // 프로젝트 업데이트
        document.getElementById('updateProjectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const projectId = document.getElementById('updateProjectId').value;
            const formData = new FormData(e.target);
            
            const updateData = {};
            if (formData.get('projectName')) updateData.projectName = formData.get('projectName');
            if (formData.get('description')) updateData.description = formData.get('description');
            if (formData.get('duration')) updateData.duration = formData.get('duration');
            if (formData.get('grossFloorArea')) updateData.grossFloorArea = formData.get('grossFloorArea');
            if (formData.get('client')) updateData.client = formData.get('client');
            if (formData.get('architect')) updateData.architect = formData.get('architect');
            if (formData.get('index')) updateData.index = parseInt(formData.get('index'));
            if (formData.get('isAvailable')) updateData.isAvailable = formData.get('isAvailable') === 'true';

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${projectId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData)
                });

                const result = await response.json();

                if (response.ok) {
                    showResult('프로젝트 업데이트 성공!', 'success');
                    loadProjects();
                } else {
                    showResult(`프로젝트 업데이트 실패: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        });

        // 이미지 관리를 위한 로드
        async function loadImagesForManagement() {
            try {
                const response = await fetch(`${API_BASE_URL}/images`);
                const images = await response.json();

                if (response.ok) {
                    const container = document.getElementById('availableImages');
                    container.innerHTML = '';
                    
                    images.forEach(image => {
                        const imageDiv = document.createElement('div');
                        imageDiv.className = 'image-item';
                        imageDiv.onclick = () => toggleImageSelection(image.id, imageDiv);
                        
                        imageDiv.innerHTML = `
                            <img src="${API_BASE_URL}${image.imageURL}" alt="${image.fileName}" class="image-thumbnail">
                            <div>ID: ${image.id}</div>
                            <div>${image.fileName}</div>
                        `;
                        
                        container.appendChild(imageDiv);
                    });
                    
                    document.getElementById('imageManagement').style.display = 'block';
                    showResult('이미지 목록을 로드했습니다.', 'success');
                } else {
                    showResult('이미지 로드 실패', 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        function toggleImageSelection(imageId, element) {
            const index = selectedImages.indexOf(imageId);
            if (index > -1) {
                selectedImages.splice(index, 1);
                element.classList.remove('selected');
            } else {
                selectedImages.push(imageId);
                element.classList.add('selected');
            }
        }

        async function updateProjectImages() {
            const projectId = document.getElementById('manageProjectId').value;
            if (!projectId) {
                showResult('프로젝트 ID를 입력해주세요.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${projectId}/images`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(selectedImages)
                });

                const result = await response.json();

                if (response.ok) {
                    showResult('프로젝트 이미지 업데이트 성공!', 'success');
                    selectedImages = [];
                    document.querySelectorAll('.image-item.selected').forEach(el => el.classList.remove('selected'));
                    loadProjects();
                } else {
                    showResult(`이미지 업데이트 실패: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        async function addImagesToProject() {
            const projectId = document.getElementById('manageProjectId').value;
            if (!projectId) {
                showResult('프로젝트 ID를 입력해주세요.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${projectId}/images`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(selectedImages)
                });

                const result = await response.json();

                if (response.ok) {
                    showResult('프로젝트에 이미지 추가 성공!', 'success');
                    selectedImages = [];
                    document.querySelectorAll('.image-item.selected').forEach(el => el.classList.remove('selected'));
                    loadProjects();
                } else {
                    showResult(`이미지 추가 실패: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        async function removeImagesFromProject() {
            const projectId = document.getElementById('manageProjectId').value;
            if (!projectId) {
                showResult('프로젝트 ID를 입력해주세요.', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${projectId}/images`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(selectedImages)
                });

                const result = await response.json();

                if (response.ok) {
                    showResult('프로젝트에서 이미지 제거 성공!', 'success');
                    selectedImages = [];
                    document.querySelectorAll('.image-item.selected').forEach(el => el.classList.remove('selected'));
                    loadProjects();
                } else {
                    showResult(`이미지 제거 실패: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        async function loadProjects() {
            try {
                const response = await fetch(`${API_BASE_URL}/projects`);
                const projects = await response.json();

                if (response.ok) {
                    const container = document.getElementById('projectList');
                    container.innerHTML = '';
                    
                    projects.forEach(project => {
                        const projectDiv = document.createElement('div');
                        projectDiv.className = 'project-card';
                        
                        projectDiv.innerHTML = `
                            ${project.projectImageUrl ? `<img src="${API_BASE_URL}${project.projectImageUrl}" alt="${project.projectName}" class="project-image">` : ''}
                            <h3>${project.projectName}</h3>
                            <p><strong>ID:</strong> ${project.id}</p>
                            <p><strong>설명:</strong> ${project.description || 'N/A'}</p>
                            <p><strong>기간:</strong> ${project.duration || 'N/A'}</p>
                            <p><strong>연면적:</strong> ${project.grossFloorArea || 'N/A'}</p>
                            <p><strong>클라이언트:</strong> ${project.client || 'N/A'}</p>
                            <p><strong>건축가:</strong> ${project.architect || 'N/A'}</p>
                            <p><strong>인덱스:</strong> ${project.index}</p>
                            <p><strong>사용 가능:</strong> ${project.isAvailable ? '예' : '아니오'}</p>
                            <p><strong>생성일:</strong> ${project.CreatedDateTime}</p>
                            <button onclick="deleteProject(${project.id})" class="delete-btn">삭제</button>
                        `;
                        
                        container.appendChild(projectDiv);
                    });
                } else {
                    showResult('프로젝트 목록 로드 실패', 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        async function deleteProject(projectId) {
            if (!confirm('정말로 이 프로젝트를 삭제하시겠습니까?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/projects/${projectId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (response.ok) {
                    showResult('프로젝트 삭제 성공!', 'success');
                    loadProjects();
                } else {
                    showResult(`프로젝트 삭제 실패: ${result.message}`, 'error');
                }
            } catch (error) {
                showResult(`오류 발생: ${error.message}`, 'error');
            }
        }

        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
            setTimeout(() => {
                resultDiv.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>
